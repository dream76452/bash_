#!/bin/bash

# –°–∫—Ä–∏–ø—Ç: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Go (Golang)
# –ê–≤—Ç–æ—Ä: –¢—ã! üòé

echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É Go..."

# 1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é Go (–º–æ–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
# –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã —É–∫–∞–∂–µ–º –≤–µ—Ä—Å–∏—é, –Ω–æ –º–æ–∂–Ω–æ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å
GO_VERSION="1.22.2"
ARCH="amd64"  # –î–ª—è Intel/AMD. –î–ª—è Apple M1/M2: arm64
OS="linux"    # –î–ª—è Linux. macOS: darwin

# 2. –§–æ—Ä–º–∏—Ä—É–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –∏ URL
FILENAME="go${GO_VERSION}.${OS}-${ARCH}.tar.gz"
URL="https://go.dev/dl/$FILENAME"
echo "–°–∫–∞—á–∏–≤–∞–µ–º: $URL"

# 3. –°–∫–∞—á–∏–≤–∞–µ–º –∞—Ä—Ö–∏–≤
wget "$URL" -O "$FILENAME"

if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏. –ü—Ä–æ–≤–µ—Ä—å URL –∏–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É."
    exit 1
fi

echo "‚úÖ –°–∫–∞—á–∞–Ω–æ: $FILENAME"

# 4. –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é Go (–µ—Å–ª–∏ –µ—Å—Ç—å)
sudo rm -rf /usr/local/go

# 5. –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –≤ /usr/local
echo "üì¶ –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –≤ /usr/local..."
sudo tar -C /usr/local -xzf "$FILENAME"

if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å–ø–∞–∫–æ–≤–∫–µ. –ü—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–≤–∞ –∏–ª–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –∞—Ä—Ö–∏–≤–∞."
    exit 1
fi

echo "‚úÖ Go —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω –≤ /usr/local/go"

# 6. –î–æ–±–∞–≤–ª—è–µ–º go –≤ PATH (–¥–ª—è bash –∏ zsh)
echo "üîß –î–æ–±–∞–≤–ª—è–µ–º go –≤ PATH..."

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫—É—é –æ–±–æ–ª–æ—á–∫—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
SHELL_TYPE=$(basename "$SHELL")

case "$SHELL_TYPE" in
    "bash")
        RC_FILE="$HOME/.bashrc"
        ;;
    "zsh")
        RC_FILE="$HOME/.zshrc"
        ;;
    *)
        RC_FILE="$HOME/.bashrc"
        echo "‚ö†Ô∏è  –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ–±–æ–ª–æ—á–∫–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º .bashrc"
        ;;
esac

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ —Å—Ç—Ä–æ–∫–∏ —Å PATH
if ! grep -q "/usr/local/go/bin" "$RC_FILE"; then
    echo 'export PATH=$PATH:/usr/local/go/bin' >> "$RC_FILE"
    echo "‚úÖ PATH –¥–æ–±–∞–≤–ª–µ–Ω –≤ $RC_FILE"
else
    echo "‚ÑπÔ∏è  PATH —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ $RC_FILE"
fi

# 7. –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É..."
/usr/local/go/bin/go version

if [ $? -eq 0 ]; then
    echo "üéâ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! Go —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω."
    echo "üí° –ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å go –≤ —ç—Ç–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, –≤—ã–ø–æ–ª–Ω–∏:"
    echo "   source $RC_FILE"
else
    echo "‚ùå –ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫. –ü–æ–ø—Ä–æ–±—É–π –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª."
fi

# 8. –£–¥–∞–ª—è–µ–º –∞—Ä—Ö–∏–≤
rm -f "$FILENAME"
echo "üßπ –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —É–¥–∞–ª—ë–Ω"
